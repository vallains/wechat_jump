前段时间微信小程序『跳一跳』火遍了朋友圈，连我爸爸妈妈都开始玩了.

我自己试着玩过几把，最好的一次跳了70分(脸红).

虽说多加练习确实是可以慢慢提高自己的分数的，不过即使有了那个实力，也是需要花大量的时间去堆砌的.

于是我尝试用代码来编写一个自动化脚本，实现自动刷分的目的.

问题难点在于对图像的识别处理，如果用java来处理的话，有点望尘莫及了.

在1024基佬的推荐下用了opencv来作为图像分析支持，这是一个很多人贡献的跨平台计算机视觉库.

编写脚本的具体思路是：

①每次起跳之前，先用ADB对手机屏幕截图



②将截图与下图棋子的切图匹配



opencv库里有一个函数matchTemplate，它能从图中匹配出你预设的模板的图片的起始位置，根据这个能够得到当前棋子的坐标点

③利用opencv的边缘检测将图片进行灰度处理，描绘出大体的轮廓



④拿到上图之后从红线开始往下扫，第一次扫到像素点为白色的时候继续往下找，

当在相同横坐标处再次遇到白色像素的点时，计算两个点的中间点的位置。像下图这样



⑤这样，获取到了棋子的位置和所需要跳的目标位置，用勾股定理计算出距离（a²+b²=c²），然后再计算出按压时间.

按压时间和距离的关系是：按压时间=距离*1.3（可以通过不断观察跳跃来调节这个参数，越精准的话分数跳的越高）

⑥用ADB指令点击屏幕固定点对应的时间，实现点击跳跃

不过，我还是太年轻了，微信官方已经加强了外挂检测



比如这样，刷出来如果被检测到作弊的话，分数无效。

我刚开始以为它是通过检测我跳的时间是否一致来判断的，

所以我将点击屏幕的时间改为了一个大于一秒小于六秒的随机数值，结果发现依然会被检测到作弊.

后来试着将点击的位置控制在失败后弹出的『再玩一局』的范围以内的一个随机像素点，

这样在低分数的情况下，跳出来的成绩是会被系统记录的.

但是在成绩很高的时候，也还是会被检测到作弊.

我记得在张小龙2018微信公开课的演讲里，有提到关于跳一跳如何检测外挂的大概内容.

就是通过成长曲线，比如当用户平时都是一两百分的，一下子就跳到了几千分，系统就会判断为是外挂了.

就像成绩经常是倒数的学生，一下子排名前列，老师是会怀疑学生作弊了的.

在公开课演讲的内容里原话是这样的

『对于外挂来说，其实这种对抗是无止境的，你今天用这种能力对抗，可能第二天外挂又提高了一种新的办法.

我们采取了一些特别的办法，这里可以泄露一点点.

对于这样一个游戏来说，其实它的成长是非常艰苦的，我并不认为有任何一个人可以不经过练习就立即达到一个非常好的水平.

按照这一点，我们会判断每个人是不是有一个成长曲线，如果不符合这样一个成长曲线，我们认为这个可能是你作弊的一种行为.』

(说实话，我很佩服那些通过自己不断练习之后达到几百分的人，他们对某一件事物的坚持精神让我动容)

根据这个思路，我试着先刷600分，然后依次加50分，发现是可行的，不会被检测为作弊。



虽然方法找到了，但是对于这种检测，目前还没有想到完美的优化脚本的方法来避免，

只能通过不断地完善自己的成长曲线，提高自己被怀疑作弊的分数线.

有趣的是，我用我同学的号来刷的时候，即使刷到了1000分以上，也没有被检测出作弊.



这样来看的话，我应该已经成为了被重点关注的对象了吧(好气啊).
